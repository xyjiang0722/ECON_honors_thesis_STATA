# Senior Honors Thesis in Economics
## Topic: The Robustness to Misspecification of Various Estimators of Average Treatment Effects  
The dataset used in this study is a synthetic dataset generated by Monte Carlo simulation. Functions that are to be estimated are p(X),μ_1 (X),μ_0 (X), p(X) is the propensity score and  μ_1 (X)  and μ_0 (X) refer to the expected value of potential outcome with and without treatment respectively. In the simulation study, I assume that the true models of p(X),μ_1 (X),μ_0 (X) are of quadratic forms, while I estimate ATE using linear models of them. This setting of misspecification is simple because I am currently still at an initial stage of research, but more cases of misspecification will be explored as the research process continues. I drew 500 random numbers of X from a uniform distribution on [0,1]. To generate the treatment variable d, I first generated a uniformly distributed variable u_d on [0,1] and then compared u_d with p(X)=α_0+α_1 X+α_2 X^2: If α_0+α_1 X+α_2 X^2≥u_d, then d=1; otherwise, d=0. This is because P(k>X)=k for X~Uniform(0,1), which leads to P(d=1)=P(p(X)>u_d )=p(X). Y(1) and  Y(0) were generated similarly for the purpose of consistency. Then the outcome variable Y can be obtained by Y=d*Y(1)+(1-d)*Y(0). The misspecified p(X),μ_1 (X),μ_0 (X) can be generated by regressing d on X and Y on X in the treated and untreated groups respectively.  
  
  
There are six estimators of average treatment effects in STATA: regression adjustment (RA), inverse-probability weighting (IPW), augmented inverse-probability weighting (AIPW), inverse-probability-weighted regression adjustment (IPWRA), nearest-neighbor matching (NNmatch), propensity-score matching (PSmatch). AIPW and IPWRA combine regression adjustment and inverse-probability weighting, and they are said to be doubly robust. For RA, NNmatch and PSmatch, STATA provides commands that can calculate ATEs using the corresponding options. For IPW, AIPW and IPWRA, the ATEs were calculated manually since STATA does not have linear probability model options for inverse probability weighting. ATEs calculated by six methods from every 500 observations form one row of data in the final dataset. By repeating this process 1,000 times, the constructed dataset contains 1,000 rows with 6 variables, each corresponding to ATE estimated by one specific method.  
  
  
Considering other possible combinations of parameters in p(X),μ_1 (X),μ_0 (X), I explored other cases of misspecification. For example, let p(X)∈[0.1,0.9] and p(0)=0.25, p(1)=0.75. For p(X)=α_0+α_1 X+α_2 X^2, it is easy to see that α_0=0.25, α_1=p(1)-p(0)-α_2. Consider the most concave, convex and monotonic shape of p(X), and we can obtain 4 different values of α_2 and thus 4 combinations of parameters. Consider p(0)=0.75, p(1)=0.25 and p(0)=0.5, p(1)=0.5, this gives me 10 combinations of parameters. Similarly, for μ_1 (X) and μ_0 (X), if we use the same setup, there are a total of 10×10×10=1,000 combinations of parameters, which leads to 1,000 datasets. After merging them, the final dataset will allow me to compare all estimators for ATE and see if doubly robust estimators perform systematically better than the others.
  
  
Run.sh is written in Unix Shell and submits the jobs. Run.do is a STATA do file that loops through each shape combination and calculate the six estimators of ATE and post the results. Generate_data.do is the STATA do file that draws the data that can be analyzed in run.do. Results_complie.do complies all the results of 1000 shape combinations and analyzes which estimator yields the least error. estimators_performance.do is to see whether some patterns show up in the simulation reslts, for example, whether regression adjustment/IPW performs better under some particular circumstances.
